<!DOCTYPE html>
<html lang="en">

<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script id='clientScript' type="text/babel">

    let champID = [];
    let imageURL = [];
    const handleResponse = (xhr, parseResponse) => {
      const content = document.querySelector('#content')

      switch (xhr.status) {
        case 200: '<b>Success!</b>;'
          break;
        case 201: '<b>Created</b>;'
          break;
        case 204: '<b>This object already exsists</b>;'
          break;
        case 400: '<b>Bad Request</b>;'

          break;
        case 404: '<b>Not Found</b>;'
          document.querySelector("#summonerNameText").innerHTML = "User Not Found";
          break;
        default:
          content.innerHTML = '<p>Error code not implemented</p>';
      }

      if (parseResponse) {
        const obj = JSON.parse(xhr.response);
        console.log(obj);

        //document.getElementById("#mastery1").src = obj.imageURLs[0];

        if (obj.champIDArray != undefined) {
          document.querySelector("#masteryName1").innerText = obj.champIDArray[0].championId;
          document.querySelector("#mastery1").src = obj.imageURLs[0];
          document.querySelector("#masteryName2").innerText = obj.champIDArray[1].championId;
          document.querySelector("#mastery2").src = obj.imageURLs[1];
          document.querySelector("#masteryName3").innerText = obj.champIDArray[2].championId;
          document.querySelector("#mastery3").src = obj.imageURLs[2];

        }

        //content.innerHTML += `<p>${xhr.response}</p>`
      } else {
        content.innerHTML += '<p>Meta Data Received</p>';
      }
    };

    const requestUpdate = (e, userForm) => {
      e.preventDefault();

      const url = userForm.querySelector('#urlField').value;
      const method = userForm.querySelector('#methodSelect').value;

      const xhr = new XMLHttpRequest();
      xhr.open(method, url);

      xhr.setRequestHeader("Accept", 'application/json');

      if (method == 'get') {
        xhr.onload = () => handleResponse(xhr, true);
      }
      else {
        xhr.onload = () => handleResponse(xhr, false);
      }
      xhr.send();

      return false;

    };


    const sendPost = (e, summonerForm) => {
      e.preventDefault();

      const nameAction = summonerForm.getAttribute('action');
      const nameMethod = summonerForm.getAttribute('method');

      const nameField = summonerForm.querySelector("#nameField");


      const xhr = new XMLHttpRequest();
      xhr.open(nameMethod, nameAction);

      xhr.setRequestHeader('Accept', 'application/json');
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urleconded');

      xhr.onload = () => handleResponse(xhr, true);

      const formData = `name=${nameField.value}`;
      document.querySelector("#summonerNameText").innerHTML = nameField.value;
      xhr.send(formData);

      return false;
    };
    const sendNewUser = (e, userForm) => {
      e.preventDefault();

      const nameAction = userForm.getAttribute('action');
      const nameMethod = userForm.getAttribute('method');

      const nameField = document.querySelector("#summonerNameText").innerHTML;


      if (nameField == "User Not Found") {
        console.log("SEND USER" + nameField);

        return false;
      }

      const xhr = new XMLHttpRequest();
      xhr.open(nameMethod, nameAction);

      xhr.setRequestHeader('Accept', 'application/json');
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urleconded');

      xhr.onload = () => handleResponse(xhr, true);

      const formData = `name=${nameField}`;
      console.log(formData);
      xhr.send(formData);

      return false;
    };


    const init = () => {
      const summonerForm = document.querySelector("#summonerForm");
      const userForm = document.querySelector("#userForm");
      const setMastery = (e) => sendPost(e, summonerForm);
      const addUsers = (e) => sendNewUser(e, userForm);


      //console.log("After Request and Post" + champsList);

      userForm.addEventListener('submit', addUsers);
      summonerForm.addEventListener('submit', setMastery);
    };

    window.onload = init;


  </script>
</head>

<body>
  <section id="top">
    <h2>League Of Legends Summoner Finder</h3>
      <form id="summonerForm" action="/setUser" method="post">
        <label for="name">Summoner Name: </label>
        <input id="nameField" type="text" name="name" />
        <input type="submit" value="Find Summoner" />
      </form>
      <form id="userForm" action="/addUser" method="post">
        <input type="submit" value="Add Current User" />
      </form>
  </section>
  <section id="content">
    <h3 id="summonerNameText">Summoner Name Here</h3>
    <p id="masteryName1"></p>
    <p id="masteryName2"></p>
    <p id="masteryName3"></p>
    <img id="mastery1" src="https://www.nomadfoods.com/wp-content/uploads/2018/08/placeholder-1-e1533569576673.png"
      width="10%" height="10%" />
    <img id="mastery2" src="https://www.nomadfoods.com/wp-content/uploads/2018/08/placeholder-1-e1533569576673.png"
      width="10%" height="10%" />
    <img id="mastery3" src="https://www.nomadfoods.com/wp-content/uploads/2018/08/placeholder-1-e1533569576673.png"
      width="10%" height="10%" />
  </section>
</body>

</html>